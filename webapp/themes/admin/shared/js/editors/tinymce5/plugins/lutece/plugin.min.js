
// tinymce.PluginManager.add('lutece', function(editor, url) {
// editor.ui.registry.addButton("lutece",{
// 	icon:true,
// 	image: url +'/img/lutece.png',
// 	tooltip: "Insert Lutece Link",
// 	onclick:function(){
// 		console.log( "tinyMCE.base_url : " + url );
// 		editor.windowManager.open(
// 		    {title:"Lutece",url: url + "../../../../../../jsp/admin/insert/GetAvailableInsertServices.jsp?input=" + editor.name + "&selected_text=" + editor.selection.getContent({format : 'text'}) ,width:800,height:500,buttons:[{text:"Close",onclick:"close"}]}
// 		)}
// 	}),

// 	editor.ui.registry.addMenuItem("lutece",{
// 		image: url +'/img/lutece.png',
// 		text:"Insert Lutece Link",
// 		context:"insert",
// 		prependToContext:!0,
// 		onclick:function(){
// 			editor.windowManager.open(
// 				{title:"Lutece",url: url + "../../../../../../jsp/admin/insert/GetAvailableInsertServices.jsp?input=&selected_text=",width:800,height:600,buttons:[{text:"Close",onclick:"close"}]}
// 			)}
// 		})
// 	}
// );

/*
  Note: We have included the plugin in the same JavaScript file as the TinyMCE
  instance for display purposes only. Tiny recommends not maintaining the plugin
  with the TinyMCE instance and using the `external_plugins` option.
*/
tinymce.PluginManager.add( 'lutece', function(editor, url) {
	editor.ui.registry.addIcon('lutece', url +'/img/lutece.png' );
	var openDialog = function () {
	  return editor.windowManager.open({
		title: 'Lutece Insert service',
		body: {
		  type: 'panel',
		  items: [
			{
				name: 'preview',
				type: 'iframe',
				streamContent: true
			}
		  ]
		},
		buttons: [
		  {
			type: 'cancel',
			text: 'Close'
		  },
		  {
			type: 'submit',
			text: 'Save',
			primary: true
		  }
		],
		onSubmit: function (api) {
		  var data = api.getData();
		  /* Insert content when the window form is submitted */
		  editor.insertContent( 'Title: ' + data.title );
		  api.close();
		}
	  });
	};
	/* Add a button that opens a window */
	editor.ui.registry.addButton('Lutece', {
		text: 'Lutece',
	  	onAction: function () {
			/* Open window */
			openDialog();
			`onAction: (api) => api.setData({ myiframe: 'new content' })`
	  	}
	});
	/* Adds a menu item, which can then be included in any menu via the menu/menubar configuration */
	editor.ui.registry.addMenuItem('lutece', {
	  text: 'Lutece plugin',
	  onAction: function() {
		/* Open window */
		openDialog();
	  }
	});
	/* Return the metadata for the help plugin */
	return {
	  getMetadata: function () {
		return  {
		  name: 'Lutece plugin',
		  url: 'https://lutece.paris.fr'
		};
	  }
	};
  });
  tinymce.PluginManager.requireLangPack('lutece', 'fr_FR');  